"use strict";angular.module("grapheApp",["ngAnimate","ngMaterial","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",index:1}).when("/graph",{templateUrl:"views/graph.html",controller:"GraphCtrl",index:2}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",index:3}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl",index:4}).otherwise({redirectTo:"/"})}]),angular.module("grapheApp").controller("MainCtrl",["$scope","$mdSidenav","$mdToast","$location",function(a,b,c,d){a.showHelp=function(){a.showSimpleToast(a.currentOption.message)},a.setMessage=function(b){a.message=b},a.hasMessages=function(){return null!==a.message&&void 0!==a.message&&""!==a.message},a.isShowContextToolbar=!1,a.showContextToolbar=function(){a.isShowContextToolbar=!0},a.hideContextToolbar=function(){a.isShowContextToolbar=!1,a.hideFab=!1},a.setCurrentOption=function(b){a.currentOption=b},a.getCurrentOption=function(){return a.currentOption},a.toastPosition={bottom:!0,top:!1,left:!1,right:!0},a.fabOptions={add:{name:"Add",icon:"add",message:"Click anywhere on the stage to add a node.",enabled:!0,color:"#4CAF50",contextOptions:[{name:"Add Node",icon:"add_circle",message:"Click anywhere to add a node."},{name:"Add Link",icon:"settings_ethernet",message:"Select a node to connect to another.",enabled:!0,color:"#4CAF50"}]},remove:{name:"Remove",icon:"clear",message:"Click on a node or link to remove.",enabled:!0,color:"#F44336"},select:{name:"Select",icon:"check",message:"Click on a node or link to select.",enabled:!0,color:"#FF9800",contextOptions:[{name:"Select",icon:"select_all",message:"Select all."}]},info:{name:"Information",icon:"info",message:"Click on a node or link for information, click on stage to global information.",enabled:!0,color:"#2196F3"}},a.showSimpleToast=function(b){void 0!==c&&(console.log("toast"),c.show(c.simple().content(b).action("Got it.").highlightAction(!1).position(a.getToastPosition()).hideDelay(3e3)).then(function(){console.log("got it.")}))},a.getToastPosition=function(){return Object.keys(a.toastPosition).filter(function(b){return a.toastPosition[b]}).join(" ")},a.toggleSidenav=function(a){b(a).toggle()},a.menuOptions=[{label:"Home",link:"/"},{label:"New Graph",link:"/graph"},{label:"Help",link:"/about"}],a.go=function(b,c){d.path(b),c&&a.toggleSidenav("left"),console.log(b)},a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.cancel=function(){a.hideContextToolbar(),a.setMessage(null),a.setCurrentOption({})}}]),angular.module("grapheApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("grapheApp").controller("GraphCtrl",["$scope","$window","GraphService",function(a,b,c){function d(){var b=$("#graphStageDiv");a.width=b.width(),a.height=b.height()}a.h=c.getGraph(5),a.h.addEdge(0,1),a.h.addEdge(1,2),a.h.addEdge(2,3),a.h.addEdge(3,4),a.h.addEdge(4,0),a.h.addEdge(0,3),a.h.addEdge(4,2),a.graph={nodes:a.h.getNodes(),links:a.h.getLinks()},a.updateNodeCount=function(){console.log("updating node count"),a.graph.nodes=a.h.getNodes(),a.graph.links=a.h.getLinks()},a.matrix=a.h.getAdjacentMatrix(),a.$watch("scope.h.getAdjacentMatrix()",function(){a.matrix=a.h.getAdjacentMatrix(),console.log(a.matrix)}),a.selectNode=function(a){d3.select("#node-"+a+" circle").transition().duration(750).ease("elastic").attr("r",50),console.log(a)},a.deselectNode=function(a){d3.select("#node-"+a+" circle").transition().duration(100).ease("linear").attr("r",15),console.log("deselected:"+a)},a.checkAdjacent=function(b,c){for(var d=0;d<a.h.linkList.length;d++)if(a.h.linkList[d].source.id===b.id&&a.h.linkList[d].target.id===c.id)return!0;return!1},a.currentOption=a.fabOptions.add,a.isOpen=!1,a.hideFab=!1,a.setSelectedOption=function(b){a.setCurrentOption(b),a.toggleFab(),a.showContextToolbar()},a.selectedRow=null,a.selectedColumn=null,a.selectCell=function(b,c){a.selectedRow=b,a.selectedColumn=c},a.deselectCell=function(){a.selectedRow=null,a.selectedColumn=null},a.toggleFab=function(){a.isOpen=!a.isOpen},d(),angular.element(b).on("resize",function(){a.$apply(function(){d()})}),a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("grapheApp").directive("graph",function(){return{template:"<div></div>",restrict:"E",link:function(a,b,c){function d(){j=r.append("g").attr("class","x axis").selectAll("line").data(d3.range(0,p,o)).enter().append("line").attr("x1",function(a){return a}).attr("y1",0).attr("x2",function(a){return a}).attr("y2",q),k=r.append("g").attr("class","y axis").selectAll("line").data(d3.range(0,q,o)).enter().append("line").attr("x1",0).attr("y1",function(a){return a}).attr("x2",p).attr("y2",function(a){return a})}function e(){if(a.getCurrentOption()===a.fabOptions.add){var b=d3.mouse(d3.event.target);a.h.addNode(b[0],b[1]),a.updateNodeCount(),a.$apply(),a.showSimpleToast("node added!")}}function f(){v.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),w.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}function g(){var a=d3.event.translate,b=d3.event.scale;r.attr("transform","translate("+a+") scale("+b+")")}function h(){function b(b,c){console.log("dragMove"),b.px+=d3.event.dx,b.py+=d3.event.dy,b.x+=d3.event.dx,b.y+=d3.event.dy,a.$apply()}function c(a,b){d3.event.sourceEvent.stopPropagation(),console.log("dragStart")}function d(a,b){console.log("dragEnd")}function e(b){console.log("mouseDownNode");var c=this;d3.event.stopPropagation(),a.getCurrentOption()===a.fabOptions.remove?(a.$apply(function(){console.log(b),a.h.removeNode(b)}),a.showSimpleToast("node removed!"),a.updateNodeCount()):a.getCurrentOption()===a.fabOptions.info?console.log(b):a.getCurrentOption()===a.fabOptions.add.contextOptions[1]&&(console.log("add link"),a.firstNode?a.firstNode!==b&&a.$apply(function(){a.h.addEdge(a.firstNode.index,b.index),delete a.firstNode,a.setMessage(null)}):a.$apply(function(){a.firstNode=b,d3.select(c).selectAll("circle").style({stroke:"black","stroke-width":0}).transition().duration(100).ease("linear").style({stroke:"black","stroke-width":2}),console.log(b),a.setMessage("Select next node.")})),h()}n.attr("width",a.width).attr("height",a.height),v=v.data(u),v.enter().append("line").attr("class","link"),v.exit().remove(),v.classed("link_selected",function(a){return a===m}),w=w.data(t),i=w.select("g").attr("id",function(a,b){return"node-"+b}),w.select(".node circle").attr("fill",function(a){return a.color}),w.select(".node text").text(function(a){return a.label}),i=w.enter().append("g").attr("id",function(a,b){return"node-"+b}),i.attr("class","node").append("circle").attr("fill",function(a){return a.color}).attr("r",1).transition().duration(750).ease("elastic").attr("r",15),w.exit().select("circle").attr("r",15).transition().duration(500).ease("linear").attr("r",1).remove(),w.exit().select("text").remove();var f=d3.behavior.drag().on("drag",b).on("dragstart",c).on("dragend",d);i.call(f),i.on("click",e);i.append("text").attr("dx",0).attr("fill","white").attr("text-anchor","middle").attr("dy",".35em").text(function(a){return a.label}).on("click",function(a){});w.exit().transition().attr("r",0).remove(),w.classed("node_selected",function(a){return a===l}),s.start()}angular.element(b[0]).empty();var i,j,k,l=null,m=null,n=d3.select(b[0]).append("svg:svg").attr("width",a.width).attr("height",a.height).attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",g)),o=20,p=2e3,q=2e3,r=n.append("svg:g").attr("width",p).attr("height",q).on("dblclick.zoom",null).on("click",e).append("svg:g");d(),r.append("svg:rect").attr("width",p).attr("height",q).attr("fill","none");var s=d3.layout.force().size([a.width,a.height]).nodes(a.graph.nodes).links(a.graph.links).on("tick",f),t=(r.append("line").attr("class","drag_line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0),s.nodes()),u=s.links(),v=r.append("g").selectAll(".link"),w=r.append("g").selectAll(".node");h(),a.$watch("width",h),a.$watch("height",h),a.$watch("graph",h,!0),a.$watch("currentOption",function(){a.currentOption===a.fabOptions.select&&i.select(".node").style({cursor:"hand"}),a.currentOption===a.fabOptions.add&&i.select(".node").style({cursor:"hand"}),a.currentOption===a.fabOptions.remove&&(i.style({cursor:"pointer"}),i.call(function(){console.log(this)})),console.log("currentOption: "+a.currentOption)})}}}),angular.module("grapheApp").controller("ContactCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.email=""}]),angular.module("grapheApp").controller("MenuCtrl",["$scope","$rootScope",function(a,b){this.option=1;var c=this;b.$on("$routeChangeSuccess",function(a,b,d){c.selectOption(b.index)}),this.selectOption=function(a){this.option=a},this.isSelected=function(a){return this.option===a},a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("grapheApp").service("GraphService",function(){function a(){var a=Math.floor(Math.random()*e.length),b=f(a);return console.log(b),b}function b(a){return String.fromCharCode(a.charCodeAt(0)+1)}function c(){var a=g;return g=b(g),a}function d(b){this.getAdjacentMatrix=function(){return this.matrix},this.getAdjacentList=function(){return this.adjacentList},this.removeLinksForNode=function(a){var b=this,c=this.linkList.filter(function(b){return b.source.index===a.index||b.target.index===a.index});c.map(function(a){var c=b.linkList.indexOf(a);b.linkList.splice(c,1)})},this.removeNode=function(a){this.adjacentList.splice(a.index,1),this.marked.splice(a.index,1),this.nodeList.splice(a.index,1),this.removeLinksForNode(a),this.nodes--,this.updateAdjacencyMatrix()},this.getLinks=function(){return this.linkList},this.addNode=function(b,d){var e=this.nodeList.length,f={name:"dummy node",x:void 0!==b?b:200*Math.random(),y:void 0!==d?d:200*Math.random(),fixed:!0,color:a(),label:c(),index:e};this.nodeList.push(f),this.adjacentList[this.nodes]=[],this.adjacentList[this.nodes].push(f),this.marked[this.nodes]=!1,this.nodes++,this.updateAdjacencyMatrix()},this.updateAdjacencyMatrix=function(){var a=this;this.matrix=[];var b=this.nodeList.length;b>0&&(this.nodeList.forEach(function(c,d){a.matrix[d]=d3.range(b).map(function(){return{value:0}})}),this.linkList.forEach(function(b){a.matrix[b.source.index][b.target.index].value=1,a.matrix[b.target.index][b.source.index].value=1}))},this.addEdge=function(a,b){this.adjacentList[a].push(this.nodeList[b]),this.adjacentList[b].push(this.nodeList[a]),this.linkList.push({source:this.nodeList[a],target:this.nodeList[b]}),this.edges++,this.updateAdjacencyMatrix()},this.getNodes=function(){return this.nodeList},this.showGraph=function(){for(var a="",b=0;b<this.nodes;++b){a+=b+" -> ";for(var c=0;c<this.nodes;++c)void 0!==this.adjacentList[b][c]&&(a+=this.adjacentList[b][c]+" ");a+="\n"}console.log(a)},this.depthFirstSearch=function(a){this.marked[a]=!0,void 0!==this.adjacentList[a]&&console.log("Visited vertex: "+a);for(var b=0;b<this.adjacentList[a].length;b++)this.marked[b]||this.depthFirstSearch(b)},this.nodes=0,this.edges=0,this.adjacentList=[],this.nodeList=[],this.linkList=[],this.matrix=[],this.marked=[];for(var d=0;b>d;d++)this.adjacentList[d]=[],this.adjacentList[d].push(""),this.addNode(400*Math.random(),400*Math.random()),this.marked[d]=!1}var e=["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B"],f=d3.scale.ordinal().range(e),g="A";this.getGraph=function(a){return new d(a)}});