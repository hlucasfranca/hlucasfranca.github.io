"use strict";function labels(){function a(a){return String.fromCharCode(a.charCodeAt(0)+1)}function b(){var b=d;return d=a(d),b}function c(){d="A"}var d="A",e={nextChar:a,getLetter:b,restart:c};return e}function color(){function a(){var a=Math.floor(Math.random()*b.length),d=c(a);return d}var b=["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B"],c=d3.scale.ordinal().range(b),d={materialColors:b,materialColor:c,getColor:a};return d}function model(a,b){function c(a){return b.restart(),new d(a)}function d(c){function d(){return p.matrix}function e(){return p.adjacentList}function f(a){var b=[];if(void 0!==p.matrix[a])for(var c=0;c<p.matrix[a].length;c++)0!==p.matrix[c]&&b.push(p.getNodes()[c]);return b}function g(a){return[]}function h(a){var b=p.linkList.filter(function(b){return b.source.index===a.index||b.target.index===a.index});b.map(function(a){var b=p.linkList.indexOf(a);p.linkList.splice(b,1)})}function i(a){p.adjacentList.forEach(function(b,c){var d=p.adjacentList[c].filter(function(b){return a.index===b.index});d.map(function(a){p.adjacentList[c].splice(p.adjacentList[c].indexOf(a),1)})}),p.adjacentList.splice(a.index,1),p.nodeList.splice(a.index,1),p.removeLinksForNode(a),p.nodes--,p.matrix.forEach(function(b,c){p.matrix[c].splice(a.index,1)}),p.matrix.splice(a.index,1)}function j(){return p.linkList}function k(c,d){var e=p.nodeList.length,f={name:"dummy node",x:void 0!==c?c:200*Math.random(),y:void 0!==d?d:200*Math.random(),fixed:!0,color:a.getColor(),label:b.getLetter(),index:e,marked:!1};p.nodeList.push(f),p.adjacentList[e]=[],p.nodes++,p.updateAdjacencyMatrix()}function l(){p.matrix=[];var a=p.nodeList.length;a>0&&(p.nodeList.forEach(function(b,c){p.matrix[c]=d3.range(a).map(function(){return{value:0}})}),p.linkList.forEach(function(a){p.matrix[a.source.index][a.target.index].value=1,p.matrix[a.target.index][a.source.index].value=1}))}function m(a,b){-1===$.inArray(p.nodeList[b],p.adjacentList[a])&&(p.adjacentList[a].push(p.nodeList[b]),p.linkList.push({source:p.nodeList[a],target:p.nodeList[b]}),p.edges++,p.updateAdjacencyMatrix())}function n(){return p.nodeList}function o(a){var b=p.linkList.filter(function(b){return b.source===a||b.target===a});b.map(function(a){p.linkList.splice(p.linkList.indexOf(a),1)})}var p=this;p.addNode=k,p.addEdge=m,p.getNodes=n,p.getLinks=j,p.removeNode=i,p.removeLinksForNode=h,p.updateAdjacencyMatrix=l,p.spliceLinksForNode=o,p.getAdjacentMatrix=d,p.getAdjacentList=e,p.getAdjacentNodes=f,p.getIncidentNodes=g,p.nodes=0,p.edges=0,p.adjacentList=[],p.nodeList=[],p.linkList=[],p.matrix=[];for(var q=0;c>q;q++)this.addNode(400*Math.random(),400*Math.random())}var e={getGraph:c};return e}function gpAlgorithmPlayer(){return{restrict:"E",require:["^gpContainer","^?gpStage"],controller:"gpAlgorithmPlayerCtrl"}}function gpAlgorithmPlayerCtrl(a,b,c){function d(){if(g<a.steps.length){if(g>0){var b=a.steps[g-1].visited,c=a.steps[g].visited;b!==c&&a.selectLink(b.label,c.label)}var d=a.steps[g];a.selectNode(d.visited.index),a.selectedStep=d.instruction,g++}}function e(){var c=a.graph.getNodes()[0];a.selectedAlgorithm.run(a.graph,c),a.steps=a.selectedAlgorithm.instructions,b(a.nextStep,500,a.steps.length)}function f(b){a.selectedStep=b}a.steps=[],a.selectedStep=-1,a.depthInstructions=c.steps,a.result=c.result,a.algorithms=[c],a.selectedAlgorithm=a.algorithms[0];var g=0;a.nextStep=d,a.runAlg=e,a.selectStep=f}angular.module("graphe",["graphe.core","graphe.algorithms","graphe.directives","graphe.fab","graphe.model"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",index:1}).when("/graph",{templateUrl:"views/graph.html",index:2}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",index:3}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl",index:4}).otherwise({redirectTo:"/"})}]),angular.module("graphe.core",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial"]),function(){angular.module("graphe.algorithms",[])}(),angular.module("graphe.algorithms").service("dfs",function(){function a(a,b,d){d.push({instruction:0,visited:b}),b.marked=!0,d.push({instruction:1,visited:b}),a.adjacentList[b.index].forEach(function(e){d.push({instruction:2,visited:b}),d.push({instruction:3,visited:b}),e.marked||(d.push({instruction:4,visited:b}),c.run(a,e,d))}),d.push({instruction:5,visited:b}),a.getNodes().forEach(function(a){a.marked=!1})}function b(a,b){c.instructions.push({instruction:0,visited:b}),b.marked=!0,c.result.push(b.label),c.instructions.push({instruction:1,visited:b}),a.adjacentList[b.index].forEach(function(d){c.instructions.push({instruction:2,visited:b}),c.instructions.push({instruction:3,visited:b}),d.marked||(c.instructions.push({instruction:4,visited:b}),c.run(a,d))})}var c=this;c.name="Depth first search",c.steps=["procedure DFS(G,v):","label v as discovered","for all edges from v to w in G.adjacentEdges(v) do","if vertex w is not labeled as discovered then","recursively call DFS(G,w)","end of algorithm"],c.instructions=[],c.result=[],c.depthSearch=a,c.run=b}),function(){angular.module("graphe.fab",[])}(),angular.module("graphe.algorithms").service("fab",function(){var a=this;return a.fabOptions={add:{name:"Add",icon:"add",message:"Click anywhere on the stage to add a node.",enabled:!0,color:"#4CAF50",contextOptions:[{name:"Add Node",icon:"add_circle",message:"Click anywhere to add a node."},{name:"Add Link",icon:"settings_ethernet",message:"Select a node to connect to another.",enabled:!0,color:"#4CAF50"}]},remove:{name:"Remove",icon:"clear",message:"Click on a node or link to remove.",enabled:!0,color:"#F44336"},select:{name:"Select",icon:"check",message:"Click on a node or link to select.",enabled:!0,color:"#FF9800",contextOptions:[{name:"Select",icon:"select_all",message:"Select all."}]},info:{name:"Information",icon:"info",message:"Click on a node or link for information, click on stage to global information.",enabled:!0,color:"#2196F3"}},a}),function(){angular.module("graphe.model",[])}(),angular.module("graphe.model").service("labels",labels),angular.module("graphe.model").service("colors",color),angular.module("graphe.model").factory("model",["colors","labels",model]),function(){angular.module("graphe.directives",[])}(),angular.module("graphe.directives").directive("gpAlgorithmPlayer",gpAlgorithmPlayer).controller("gpAlgorithmPlayerCtrl",gpAlgorithmPlayerCtrl),gpAlgorithmPlayerCtrl.$inject=["$scope","$interval","dfs"],angular.module("graphe").directive("gpStepList",function(){return{templateUrl:"scripts/directives/gpStepList.html",restrict:"E",require:"^gpAlgorithmPlayer",link:function(a,b,c,d){}}}),angular.module("graphe.directives").directive("gpContainer",function(){return{controller:"gpContainerCtrl",restrict:"A"}}).controller("gpContainerCtrl",["$scope","$window","dfs","$interval","model","colors","labels",function(a,b,c,d,e,f,g){function h(b){a.setCurrentOption(b),a.toggleFab(),a.showContextToolbar()}function i(b,c){a.selectedRow=b,a.selectedColumn=c}function j(){a.selectedRow=null,a.selectedColumn=null}function k(){a.isOpen=!a.isOpen}function l(b,c){for(var d=0;d<a.graph.linkList.length;d++)if(a.graph.linkList[d].source.id===b.id&&a.graph.linkList[d].target.id===c.id)return!0;return!1}function m(){var b=$("#gp-stage-container");a.stageWidth=b.width(),a.stageHeight=b.height()}function n(){console.log("updating node count"),a.graph.nodes=a.graph.getNodes(),a.graph.links=a.graph.getLinks()}var o=5;a.currentOption=a.fabOptions.add,a.isOpen=!1,a.graphideFab=!1,a.selectedRow=null,a.selectedColumn=null,a.stageWidth=0,a.stageHeight=0,m(),a.graph=e.getGraph(o);for(var p=0;o>p;p++)for(var q=0;o>q;q++)p!==q&&a.graph.addEdge(p,q);a.checkAdjacent=l,a.updateNodeCount=n,a.setSelectedOption=h,a.selectCell=i,a.deselectCell=j,a.toggleFab=k,a.matrix=a.graph.getAdjacentMatrix(),a.$watch("scope.graph.getAdjacentMatrix()",function(){a.matrix=a.graph.getAdjacentMatrix(),console.log(a.matrix)}),m(),angular.element(b).on("resize",function(){a.$apply(function(){m()})})}]),angular.module("graphe.directives").directive("gpStage",function(){return{templateUrl:"scripts/directives/gpStage.html",restrict:"E",replace:!0,require:"^gpContainer",controller:"gpStageCtrl",link:function(a,b,c,d){function e(){o=t.append("g").attr("class","x axis").selectAll("line").data(d3.range(0,r,q)).enter().append("line").attr("x1",function(a){return a}).attr("y1",0).attr("x2",function(a){return a}).attr("y2",s),p=t.append("g").attr("class","y axis").selectAll("line").data(d3.range(0,s,q)).enter().append("line").attr("x1",0).attr("y1",function(a){return a}).attr("x2",r).attr("y2",function(a){return a})}function f(){if(a.getCurrentOption()===a.fabOptions.add){var b=d3.mouse(d3.event.target);a.graph.addNode(b[0],b[1]),a.updateNodeCount(),a.$apply(),a.showSimpleToast("node added!")}}function g(){y.each(j(.5)),y.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),x.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y})}function h(){var a=d3.event.translate,b=d3.event.scale;t.attr("transform","translate("+a+") scale("+b+")")}function i(){function b(b,c){console.log("dragMove"),b.px+=d3.event.dx,b.py+=d3.event.dy,b.x+=d3.event.dx,b.y+=d3.event.dy,a.$apply()}function c(a,b){d3.event.sourceEvent.stopPropagation(),console.log("dragStart")}function d(a,b){console.log("dragEnd")}function e(b){console.log("mouseDownNode");var c=this;d3.event.stopPropagation(),a.getCurrentOption()===a.fabOptions.remove?(a.graph.removeNode(b),a.$apply(),a.updateNodeCount(),a.showSimpleToast("node removed!")):a.getCurrentOption()===a.fabOptions.info?console.log(b):a.getCurrentOption()===a.fabOptions.add.contextOptions[1]&&(console.log("add link"),a.firstNode?a.firstNode!==b&&a.$apply(function(){a.graph.addEdge(a.firstNode.index,b.index),delete a.firstNode,a.setMessage(null)}):a.$apply(function(){a.firstNode=b,d3.select(c).selectAll("circle").style({stroke:"black","stroke-width":0}).transition().duration(100).ease("linear").style({stroke:"black","stroke-width":2}),console.log(b),a.setMessage("Select next node.")})),i()}n.attr("width",a.stageWidth).attr("height",a.stageHeight),x=x.data(w),x.enter().append("line").attr("class","link").attr("id",function(a){return"link_"+a.source.label+"_"+a.target.label}),x.exit().remove(),x.classed("link_selected",function(a){return a===m}),y=y.data(v),k=y.select("g").attr("id",function(a,b){return"node-"+b}),y.select(".node circle").attr("fill",function(a){return a.color}),y.select(".node text").text(function(a){return a.label}),k=y.enter().append("g").attr("id",function(a,b){return"node-"+b}),k.attr("class","node").append("circle").attr("r",1).transition().duration(750).ease("elastic").attr("r",15),y.exit().select("circle").attr("r",15).transition().duration(500).ease("linear").attr("r",1).remove(),y.exit().select("text").remove();var f=d3.behavior.drag().on("drag",b).on("dragstart",c).on("dragend",d);k.call(f),k.on("click",e);k.append("text").attr("dx",0).attr("text-anchor","middle").attr("dy",".35em").text(function(a){return a.label}).on("click",function(a){});y.exit().transition().attr("r",0).remove(),y.classed("node_selected",function(a){return a===l}),u.start()}function j(b){var c=d3.geom.quadtree(a.graph.nodeList);return function(a){var d=2*A+z,e=a.x-d,f=a.x+d,g=a.y-d,h=a.y+d;c.visit(function(c,i,j,k,l){if(c.point&&c.point!==a){var m=a.x-c.point.x,n=a.y-c.point.y,o=Math.sqrt(m*m+n*n);d>o&&(o=(o-d)/o*b,m*=o,n*=o,a.x-=m,a.y-=n,c.point.x+=m,c.point.y+=n)}return i>f||e>k||j>h||g>l})}}var k,l=null,m=null,n=d3.select(b[0]).append("svg:svg").attr("width",a.stageWidth).attr("height",a.stageHeight).attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",h));n.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",25).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5 L10,0 L0, -5").classed("marker",!0).style("opacity","1");var o,p,q=20,r=2e3,s=2e3,t=n.append("svg:g").attr("width",r).attr("height",s).on("dblclick.zoom",null).on("click",f).append("svg:g");e(),t.append("svg:rect").attr("width",r).attr("height",s).attr("fill","none");var u=d3.layout.force().size([a.width,a.height]).nodes(a.graph.nodeList).links(a.graph.linkList).on("tick",g),v=u.nodes(),w=u.links(),x=t.append("g").attr("id","link-group").selectAll(".link"),y=t.append("g").selectAll(".node");i();var z=2,A=15;a.$watch("stageWidth",i),a.$watch("stageHeight",i),a.$watch("graph",i,!0),a.$watch("currentOption",function(){a.currentOption===a.fabOptions.select&&k.select(".node").style({cursor:"hand"}),a.currentOption===a.fabOptions.add&&k.select(".node").style({cursor:"hand"}),a.currentOption===a.fabOptions.remove&&(k.style({cursor:"pointer"}),k.call(function(){console.log(this)})),console.log("currentOption: "+a.currentOption)})}}}).controller("gpStageCtrl",["$scope",function(a){function b(a){d3.select("#node-"+a+" circle").transition().duration(250).style("fill","#000000").attr("r",20),d3.select("#node-"+a+" text").transition().duration(250).style("fill","#ffffff"),console.log(a)}function c(a,b){function c(a){a.transition().duration(1e3).attrTween("stroke-dasharray",d)}function d(){var a=this.getTotalLength(),b=d3.interpolateString("0,"+a,a+","+a);return function(a){return b(a)}}var e=d3.select("#link_"+a+"_"+b).data()[0],f=[[e.source.x,e.source.y],[e.target.x,e.target.y]],g=d3.svg.line(),h=d3.select("svg #link-group").datum(f);h.append("path").attr("d",g).call(c)}function d(a,b){var c="#link_"+a+"_"+b;d3.select(c).transition().duration(250).style("stroke","black"),console.log("exiting link :"+c)}function e(a){d3.select("#node-"+a+" circle").transition().duration(250).ease("linear").style("fill","#ffffff").attr("r",15),d3.select("#node-"+a+" text").transition().duration(250).ease("linear").style("fill","#000000"),console.log("deselected:"+a)}a.selectNode=b,a.selectLink=c,a.deselectLink=d,a.deselectNode=e}]),angular.module("graphe.directives").directive("gpInfo",function(){return{templateUrl:"scripts/directives/gpInfo.html",restrict:"E",require:"^gpContainer",link:function(a,b,c){}}}),angular.module("graphe.directives").directive("gpAdjascentList",function(){return{templateUrl:"scripts/directives/gpAdjacentList.html",restrict:"E",require:"^gpContainer",link:function(a,b,c){}}}),angular.module("graphe.directives").directive("gpAdjascentMatrix",function(){return{templateUrl:"scripts/directives/gpAdjacentMatrix.html",restrict:"E",require:"^gpContainer",controller:"gpAdjacentMatrixCtrl",link:function(a,b,c){}}}).controller("gpAdjacentMatrixCtrl",function(){}),angular.module("graphe").controller("MainCtrl",["$scope","$mdSidenav","$mdToast","$location","fab",function(a,b,c,d,e){function f(){a.showSimpleToast(a.currentOption.message)}function g(b){a.message=b}function h(){return null!==a.message&&void 0!==a.message&&""!==a.message}function i(){a.isShowContextToolbar=!0}function j(){a.isShowContextToolbar=!1,a.hideFab=!1}function k(b){a.currentOption=b}function l(){return a.currentOption}function m(b){void 0!==c&&(console.log("toast"),c.show(c.simple().content(b).action("Got it.").highlightAction(!1).position(a.getToastPosition()).hideDelay(3e3)).then(function(){console.log("got it.")}))}function n(){return Object.keys(a.toastPosition).filter(function(b){return a.toastPosition[b]}).join(" ")}function o(a){b(a).toggle()}function p(b,c){d.path(b),c&&a.toggleSidenav("left"),console.log("going to: "+b)}function q(){a.hideContextToolbar(),a.setMessage(null),a.setCurrentOption({})}a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.toastPosition={bottom:!0,top:!1,left:!1,right:!0},a.menuOptions=[{label:"Home",link:"/"},{label:"New Graph",link:"/graph"},{label:"Help",link:"/about"}],a.isShowContextToolbar=!1,a.fabOptions=e.fabOptions,a.showHelp=f,a.setMessage=g,a.hasMessages=h,a.showContextToolbar=i,a.hideContextToolbar=j,a.setCurrentOption=k,a.getCurrentOption=l,a.showSimpleToast=m,a.getToastPosition=n,a.toggleSidenav=o,a.go=p,a.cancel=q}]),angular.module("graphe").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("graphe").controller("ContactCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.email=""}]),angular.module("graphe").controller("MenuCtrl",["$scope","$rootScope",function(a,b){this.option=1;var c=this;b.$on("$routeChangeSuccess",function(a,b,d){c.selectOption(b.index)}),this.selectOption=function(a){this.option=a},this.isSelected=function(a){return this.option===a},a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);